#!/usr/bin/env node

var debug = require('debug')('BMCD');
var path = require('path');

var app = require('../app');

var Config = require('../config');

var server = app.listen(Config.port, function() {
  debug('BMCD listening on port ' + server.address().port);
});

var socket = require('../socket')(server);

if (process.env.NODE_ENV != 'development'){
    process.on('uncaughtException', function (err){
        console.log('crash:' + (typeof err === 'string')?err:JSON.stringify(err));
    });
}

var io = require('socket.io')(server);
global.io = io;
io.on('connection', function (socket) {
  socket.on('getServerConsole', function (data) {
    socket.join(data['sid']);
  })
});